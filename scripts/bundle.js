(()=>{var Q=Math.pow;var f=(r,t,e)=>new Promise((i,n)=>{var o=g=>{try{l(e.next(g))}catch(C){n(C)}},p=g=>{try{l(e.throw(g))}catch(C){n(C)}},l=g=>g.done?i(g.value):Promise.resolve(g.value).then(o,p);l((e=e.apply(r,t)).next())});var a=class{static logColoredText(t,e,i,...n){console[t].call(console,`%c${t.toUpperCase()} %c[${e}]`,`font-weight: bold; color: ${i};`,"font-weight: bold; color: gray",...n)}static info(t,...e){this.logColoredText("info",t,"turquoise",...e)}static warn(t,...e){this.logColoredText("warn",t,"yellow",...e)}static error(t,...e){let i=e.find(n=>n instanceof Error);i&&console.trace(i),this.logColoredText("error",t,"red",...e)}static debug(t,...e){}};var u=class{constructor(t,e=void 0){this.x=t,e===void 0?this.y=t:this.y=e}dot(t){return this.x*t.x+this.y*t.y}add(t){return new u(this.x+t.x,this.y+t.y)}subtract(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t,this.y*t)}divide(t){return new u(this.x/t,this.y/t)}normalize(){let t=this.length;return new u(this.x/t,this.y/t)}clone(){return new u(this.x,this.y)}static distance(t,e){return Math.sqrt(Q(t.x-e.x,2)+Q(t.y-e.y,2))}static random(t){return new u(Math.random()*2-1,Math.random()*2-1).normalize().multiply(t)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new u(0,0)}toString(){return`{ ${this.x}, ${this.y} }`}};var m=class{constructor(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n}translate(t){return new m(this.x+t.x,this.y+t.y,this.width,this.height)}contains(t,e=void 0){if(t instanceof u&&e===void 0)return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y;if(t instanceof m&&e===void 0)return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height;if(typeof t=="number"&&typeof e=="number")return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height;throw new Error("Invalid arguments")}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}intersection(t){let e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width)-e,o=Math.min(this.y+this.height,t.y+t.height)-i;return new m(e,i,n,o)}get size(){return new u(this.width,this.height)}get position(){return new u(this.x,this.y)}set position(t){this.x=t.x,this.y=t.y}get center(){return new u(this.x+this.width/2,this.y+this.height/2)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new m(this.x,this.y,this.width,this.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}toString(){return`{ x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height} }`}};var R=class{static setup(){return f(this,null,function*(){this.tempCanvas=document.createElement("canvas"),this.tempCanvas.style.display="none";let t=this.tempCanvas.getContext("2d",{willReadFrequently:!0});if(!t)throw new Error("Failed to get 2D context from canvas");this.tempContext=t})}static load(t,e=null){return new Promise((i,n)=>{if(this.cache.has(t)){let p=this.cache.get(t);if(p===void 0)throw new Error("Unexpected undefined value in cache");return i(p)}let o=new Image;o.src=`${window.location.href}/assets/images/${t}.png`,o.crossOrigin="anonymous",o.style.display="none",o.id=`image-${t}`,e&&(o.width=e.width,o.height=e.height),o.onerror=p=>{a.error("ImageUtils",`Failed to load image: ${t}`,p.toString()),n(p)},o.onload=()=>{this.cache.set(t,o),i(o)}})}static get(t){if(!this.cache.has(t))return null;let e=this.cache.get(t);if(e===void 0)throw new Error("Unexpected undefined value in cache");return e}static pixelPerfectCollision(t,e,i,n){let o=new m(t.x,t.y,e.width,e.height),p=new m(i.x,i.y,n.width,n.height);if(!o.intersects(p))return!1;let l=o.intersection(p);if(l.width<=1||l.height<=1)return!1;this.tempCanvas.width=l.width,this.tempCanvas.height=l.height,this.tempContext.clearRect(0,0,l.width,l.height),this.tempContext.drawImage(s.source,e.x+(l.x-t.x),e.y+(l.y-t.y),l.width,l.height,0,0,l.width,l.height),this.tempContext.globalCompositeOperation="source-in",this.tempContext.drawImage(s.source,n.x+(l.x-i.x),n.y+(l.y-i.y),l.width,l.height,0,0,l.width,l.height);let g=this.tempContext.getImageData(0,0,l.width,l.height).data;for(let C=3;C<g.length;C+=4)if(g[C]>0)return!0;return!1}};R.cache=new Map;var M=class{static alpha(t,e){let i=t;i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=Math.round(e*255).toString(16).padStart(2,"0");return`#${i}${n}`}static interpolate(t,e,i){let n=`0x${t.trim().slice(1)}`,o=`0x${e.trim().slice(1)}`;n.length<5&&(n=n.replace(/./g,"$&$&")),o.length<5&&(o=o.replace(/./g,"$&$&"));let p=parseInt(n,16),l=parseInt(o,16),g=p>>16,C=p>>8&255,S=p&255,At=l>>16,Dt=l>>8&255,Pt=l&255,Ot=Math.round(g+(At-g)*i),It=Math.round(C+(Dt-C)*i),Lt=Math.round(S+(Pt-S)*i);return`#${(16777216+(Ot<<16)+(It<<8)+Lt).toString(16).slice(1)}`}static isColorLight(t){let e=`0x${t.trim().slice(1)}`;e.length<5&&(e=e.replace(/./g,"$&$&"));let i=parseInt(e,16),n=i>>16,o=i>>8&255,p=i&255;return Math.sqrt(.299*(n*n)+.587*(o*o)+.114*(p*p))>127.5}};var d=class{static get isDark(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static setup(){return f(this,null,function*(){d.loadVariables(),d.observeChanges()})}static loadVariables(){let t=["--background","--foreground","--secondary","--container-background","--container-border","--container-shadow"];a.info("Theme",`Setting up theme, loading ${t.length} variables...`),console.groupCollapsed("Loading theme variables");let e=getComputedStyle(document.body);for(let i of t){let n=e.getPropertyValue(i),o=i.toString().toCamelCase();d[o]=n,console.log(`%c${o}`,`color: ${M.isColorLight(n)?"#212121":"#eee"}; background-color: ${n}`)}console.groupEnd()}static observeChanges(){let t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener("change",()=>{a.info("Theme",`Changed theme to ${t.matches?"dark":"light"}`),d.loadVariables()})}};var s=class{static get source(){return d.isDark?this.sourceDark:this.sourceLight}static setup(){return f(this,null,function*(){[this.sourceLight,this.sourceDark]=yield Promise.all([R.load("spritesheet"),R.load("spritesheet-dark")])})}};s.ground={x:0,y:104,width:2400,height:26},s.groundOffset=14,s.dinoIdle={x:76,y:6,width:88,height:92},s.dino0={x:1339,y:2,width:86,height:94},s.dino1={x:1427,y:2,width:86,height:94},s.dino2={x:1515,y:2,width:86,height:94},s.dino3={x:1603,y:2,width:86,height:94},s.dino4={x:1691,y:2,width:86,height:94},s.dino5={x:1782,y:5,width:80,height:87},s.dinoCrouch1={x:1866,y:36,width:118,height:60},s.dinoCrouch2={x:1984,y:36,width:118,height:60},s.pterodactyl0={x:260,y:2,width:92,height:80},s.pterodactyl1={x:352,y:2,width:92,height:80},s.smallCactus0={x:446,y:2,width:34,height:70},s.smallCactus1={x:480,y:2,width:34,height:70},s.smallCactus2={x:514,y:2,width:34,height:70},s.smallCactus3={x:548,y:2,width:34,height:70},s.smallCactus4={x:582,y:2,width:34,height:70},s.smallCactus5={x:616,y:2,width:34,height:70},s.bigCactus0={x:652,y:2,width:50,height:100},s.bigCactus1={x:702,y:2,width:50,height:100},s.bigCactus2={x:752,y:2,width:50,height:100},s.bigCactus3={x:802,y:2,width:50,height:100},s.bigCactus4={x:852,y:2,width:102,height:100},s.resetButton={x:2,y:2,width:72,height:64},s.cloud={x:174,y:2,width:84,height:27};window.addLoadEventListener=function(r){let t=Function.oneshot(r);window.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t),document.addEventListener("load",t),window.addEventListener("ready",t),setTimeout(t,1e3)};window.addVisibilityChangeEventListener=function(r){let t=["webkit","moz","ms",""],e=Function.debounce(()=>{r(!window.isDocumentHidden())},50);t.forEach(i=>{document.addEventListener(`${i}visibilitychange`,e)}),document.onvisibilitychange=e};window.isMobile=function(){return window.matchMedia("(any-pointer: coarse)").matches};window.isDocumentHidden=function(){return["webkit","moz","ms",""].map(t=>t&&t.length>0?`${t}Hidden`:"hidden").map(t=>document[t]).reduce((t,e)=>t||e,!1)};window.getRefreshRate=function(){return new Promise((r,t)=>{let e=[60,75,100,120,144,165,240,360];setTimeout(()=>{requestAnimationFrame(i=>{requestAnimationFrame(n=>{let p=1e3/(n-i),l=e.reduce((g,C)=>Math.abs(C-p)<Math.abs(g-p)?C:g);r(l)})})},0)})};HTMLCanvasElement.prototype.screenshot=function(r="download.png"){let t=document.createElement("a");t.download=r,t.href=this.toDataURL("image/png;base64"),t.style.visibility="hidden",t.style.display="none",document.body.appendChild(t),setTimeout(()=>{t.click(),document.body.removeChild(t)},100)};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,r=>r[1].toUpperCase()).trim()};Array.prototype.remove=function(r){let t=this.indexOf(r);return t!=-1?(this.splice(t,1),!0):!1};Array.prototype.appendArray=function(r){if(!!r)for(let t=0;t<r.length;t++)this.push(r[t])};Math.clamp=function(r,t,e){return Math.min(Math.max(r,t),e)};Math.average=function(...r){return r.reduce((t,e)=>t+e,0)/r.length};Math.distance=function(r,t,e,i){return Math.sqrt(Math.pow(e-r,2)+Math.pow(i-t,2))};Math.randomInt=function(r,t){return Math.floor(Math.random()*(t-r+1))+r};Math.lerp=function(r,t,e){return r+(t-r)*e};Math.oscilate=function(r,t,e=0,i=1){let n=2*Math.PI*t,o=i-e,l=(Math.sin(n*r)+1)/2;return e+l*o};Math.smoothstep=function(r,t=0,e=1){return r=Math.clamp((r-t)/(e-t),0,1),r*r*(3-2*r)};Math.prettifyElapsedTime=function(r){let t=(e,i)=>e%1===0?Math.floor(e):e.toFixed(i);return r<1?`${Math.floor(r*1e3)}\u03BCs`:r<1e3?`${t(r,2)}ms`:r<6e4?`${t(r/1e3,2)}s`:r<36e5?`${t(r/6e4,2)}m`:`${t(r/36e5,2)}h`};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.line=function(r,t,e,i){this.beginPath(),this.moveTo(r,t),this.lineTo(e,i),this.stroke()};CanvasRenderingContext2D.prototype.fillTextAligned=function(r,t,e,i){let n=this.measureText(r);switch(i){case"left":this.fillText(r,t,e);break;case"center":this.fillText(r,t-n.width/2,e);break;case"right":this.fillText(r,t-n.width,e);break}};CanvasRenderingContext2D.prototype.drawSprite=function(r,t,e,i=void 0,n=void 0){this.drawImage(s.source,r.x,r.y,r.width,r.height,t,e,i||r.width,n||r.height)};Function.oneshot=function(r){let t=!1;return()=>{t||(t=!0,r())}};Function.timeout=function(r,t){let e=!1;return()=>{e||(e=!0,setTimeout(()=>{r(),e=!1},t))}};Function.debounce=function(r,t){let e=!1;return()=>{e||(e=!0,setTimeout(()=>{r(),e=!1},t))}};Promise.delay=function(r){return new Promise((t,e)=>{setTimeout(t,r)})};var T="'Pixelify Sans', sans-serif";var gt=-739.9000000000001,ft=1.5,L=1,V=1.25,P=450,et=10;var bt=.25,it=-25,wt=-50,yt=.35,vt=.15,Ct=.25,St=.005,Et=5,Tt=.75,H=1.5,xt=1.5,I=110,st=.1;var $=class{constructor(t=void 0){this.element=document.createElement("canvas");this.virtualWidth=0;this.virtualHeight=0;this.drawRatio=1;this.overrideRatio=void 0;t&&(this.element.id=t);let e=this.element.getContext("2d");if(!e)throw new Error("Could not get context of canvas");this.context=e,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.filter="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)",this.element.oncontextmenu=()=>!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(t,e){return e/t}setSize(t,e){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=t*this.drawRatio,this.element.height=e*this.drawRatio,this.element.style.width=`${t}px`,this.element.style.minWidth=`${t}px`,this.element.style.height=`${e}px`,this.element.style.minHeight=`${e}px`):(this.element.width=t,this.element.height=e,this.element.style.width="",this.element.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=t,this.virtualHeight=e}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(t,e,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,t,e),i.restore()}attachToElement(t){t.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}get bounds(){return new m(0,0,this.width,this.height)}get size(){return{width:this.width,height:this.height}}};var j=(S=>(S.A="a",S.ArrowUp="ArrowUp",S.ArrowDown="ArrowDown",S.ArrowLeft="ArrowLeft",S.ArrowRight="ArrowRight",S.Space=" ",S.Escape="Escape",S.F12="F12",S.Apostrophe="'",S.Quote='"',S))(j||{});var _=(i=>(i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i))(_||{});var rt=(h=>(h[h.A=0]="A",h[h.B=1]="B",h[h.X=2]="X",h[h.Y=3]="Y",h[h.LB=4]="LB",h[h.RB=5]="RB",h[h.LT=6]="LT",h[h.RT=7]="RT",h[h.Back=8]="Back",h[h.Start=9]="Start",h[h.LS=10]="LS",h[h.RS=11]="RS",h[h.Up=12]="Up",h[h.Down=13]="Down",h[h.Left=14]="Left",h[h.Right=15]="Right",h[h.UNUSED_0=16]="UNUSED_0",h[h.UNUSED_1=17]="UNUSED_1",h[h.UNUSED_2=18]="UNUSED_2",h[h.UNUSED_3=19]="UNUSED_3",h[h.UNUSED_4=20]="UNUSED_4",h))(rt||{});var y=class{static load(t){return new Promise((e,i)=>{if(this.cache.has(t)){let o=this.cache.get(t);if(!o)throw new Error("Unexpected undefined value in cache");return e(o)}let n=new Audio(`${window.location.href}assets/audio/${t}.mp3`);n.crossOrigin="anonymous",n.volume=.2,n.id=`audio-${t}`,n.preload="none",n.onerror=o=>{a.error("AudioUtils",`Failed to load audio: ${t}`,JSON.stringify(o,["message","arguments","type","name"])),i(o)},n.oncanplay=()=>{a.info("AudioUtils",`Loaded audio: ${t}`),this.cache.set(t,n),e(n)}})}static setup(){return f(this,null,function*(){try{Promise.all([this.load("jump"),this.load("gameover"),this.load("score"),this.load("phase")])}catch(t){a.error("AudioUtils","Failed to load audio",t)}})}static play(t){let e=this.cache.get(t);if(e===void 0){a.warn("AudioUtils",`Audio not found: ${t}`);return}e.currentTime=0,e.play()}};y.cache=new Map;var c=class{static get isDirty(){return this.invalidated}static isKeyDown(...t){return t.some(e=>{var i;return(i=this.keys[e])==null?void 0:i.active})}static isKeyUp(...t){return t.some(e=>{var i;return!((i=this.keys[e])!=null&&i.active)})}static isKeyJustPressed(...t){return t.some(e=>{var i;return(i=this.keys[e])==null?void 0:i.justPressed})}static isKeyJustReleased(...t){return t.some(e=>{var i;return(i=this.keys[e])==null?void 0:i.justReleased})}static isKeyLongPressed(...t){return t.some(e=>{var i;return(i=this.keys[e])==null?void 0:i.longPress})}static isKeyShortPressed(...t){return t.some(e=>{var i;return(i=this.keys[e])==null?void 0:i.shortPress})}static onKeyDown(t){t.repeat||!Object.values(j).includes(t.key)||(this.VERBOSE_KEYBOARD&&a.debug("Input",`Key down: ${t.key}`),this.keys[t.key]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},this.invalidated=!0)}static onKeyUp(t){if(t.repeat||!Object.values(j).includes(t.key))return;this.VERBOSE_KEYBOARD&&a.debug("Input",`Key up: ${t.key}`);let e=this.keys[t.key];if(!e)return;e.active=!1,e.lastChange=Date.now(),e.justPressed=!1,e.justReleased=!0;let i=e.lastChange-e.lastTrigger;e.longPress=i>=I,e.shortPress=!e.longPress,this.invalidated=!0}static updateKeyboard(){for(let t in this.keys){if(!this.keys.hasOwnProperty(t))continue;let e=this.keys[t];e.justReleased=!1,e.justPressed=!1,e.shortPress=!1,e.longPress=e.active&&Date.now()-e.lastChange>=I}}static isMouseButtonDown(...t){return t.some(e=>{var i;return(i=this.mouseButtons[e])==null?void 0:i.active})}static isMouseButtonUp(...t){return t.some(e=>!this.mouseButtons[e]||!this.keys[e].active)}static isMouseButtonJustPressed(...t){return t.some(e=>{var i;return(i=this.mouseButtons[e])==null?void 0:i.justPressed})}static isMouseButtonJustReleased(...t){return t.some(e=>{var i;return(i=this.mouseButtons[e])==null?void 0:i.justReleased})}static isMouseButtonLongPressed(...t){return t.some(e=>{var i;return(i=this.mouseButtons[e])==null?void 0:i.longPress})}static isMouseButtonShortPressed(...t){return t.some(e=>{var i;return(i=this.mouseButtons[e])==null?void 0:i.shortPress})}static onMouseMove(t){var e,i,n,o;this.VERBOSE_MOUSE&&a.debug("Input",`Mouse move: ${t.clientX}, ${t.clientY}`),this.mouseDelta.x=t.movementX,this.mouseDelta.y=t.movementY,this.mouse.x=t.clientX-((i=(e=t.target)==null?void 0:e.offsetLeft)!=null?i:0),this.mouse.y=t.clientY-((o=(n=t.target)==null?void 0:n.offsetTop)!=null?o:0)}static onMouseDown(t){!Object.values(_).includes(t.button)||(this.VERBOSE_MOUSE&&a.debug("Input",`Mouse down: ${t.button}`),this.mouseButtons[t.button]={active:!0,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!0,justReleased:!1,longPress:!1,shortPress:!1},this.invalidated=!0)}static onMouseUp(t){if(!Object.values(_).includes(t.button))return;this.VERBOSE_MOUSE&&a.debug("Input",`Mouse up: ${t.button}`);let e=this.mouseButtons[t.button];if(!e)return;e.active=!1,e.lastChange=Date.now(),e.justPressed=!1,e.justReleased=!0;let i=e.lastChange-e.lastTrigger;e.longPress=i>=I,e.shortPress=!e.longPress,this.invalidated=!0}static onPointerDown(t,e){!Object.values(_).includes(e.button)||(t.setPointerCapture(e.pointerId),this.onMouseDown(e))}static onPointerUp(t,e){!Object.values(_).includes(e.button)||(t.releasePointerCapture(e.pointerId),this.onMouseUp(e))}static updateMouse(){for(let t in this.mouseButtons){if(!this.mouseButtons.hasOwnProperty(t))continue;let e=this.mouseButtons[t];e.justReleased=!1,e.justPressed=!1,e.shortPress=!1,e.longPress=e.active&&Date.now()-e.lastChange>=I}this.mouseDelta.x=0,this.mouseDelta.y=0}static isGamepadButtonDown(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.active)===!0})}static isGamepadButtonUp(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.active)===!0})}static isGamepadButtonJustPressed(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.justPressed)===!0})}static isGamepadButtonJustReleased(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.justReleased)===!0})}static isGamepadButtonLongPressed(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.longPress)===!0})}static isGamepadButtonShortPressed(...t){return t.some(e=>{var i;return((i=this.gamepadButtons[e])==null?void 0:i.shortPress)===!0})}static onGamepadConnected(t){this.VERBOSE_GAMEPAD&&a.info("Input",`Gamepad connected: ${t.gamepad.id}`),this.gamepad=t.gamepad,this.isFirstGamepadConnection&&(this.isFirstGamepadConnection=!1,this.invalidated=!0)}static onGamepadDisconnected(t){this.VERBOSE_GAMEPAD&&a.info("Input",`Gamepad disconnected: ${t.gamepad.id}`),this.gamepad=null}static onGamepadPoll(){let t=navigator.getGamepads().find(e=>e);!t||(this.VERBOSE_GAMEPAD&&a.debug("Input",`Gamepad found: ${t.id}`),this.gamepad=t,this.isFirstGamepadConnection&&(this.isFirstGamepadConnection=!1,this.invalidated=!0),clearInterval(this.gamepadPollingIntervalHandle))}static requestGamepadPoll(){this.gamepadPollingIntervalHandle=setInterval(this.onGamepadPoll.bind(this),500)}static pollForConnectedGamepad(){var e;let t=navigator.getGamepads().find(i=>{var n;return i&&i.id===((n=this.gamepad)==null?void 0:n.id)});t?this.gamepad=t:(this.VERBOSE_GAMEPAD&&a.info("Input",`Gamepad disconnected: ${(e=this.gamepad)==null?void 0:e.id}`),this.gamepad=null,this.requestGamepadPoll())}static updateGamepads(){if(!!this.gamepad&&("ongamepadconnected"in window||this.pollForConnectedGamepad(),this.gamepad))for(let t=0;t<this.gamepad.buttons.length;t++){let e=this.gamepad.buttons[t],i=this.gamepadButtons[t];if(e.pressed!==i.active)if(this.invalidated=!0,e.pressed)i.active=!0,i.lastChange=Date.now(),i.justPressed=!0,i.justReleased=!1,i.lastTrigger=Date.now(),i.longPress=!1,i.shortPress=!1;else{i.active=!1,i.lastChange=Date.now(),i.justPressed=!1,i.justReleased=!0;let n=i.lastChange-i.lastTrigger;i.longPress=n>=I,i.shortPress=!i.longPress}else i.justReleased=!1,i.justPressed=!1,i.shortPress=!1,i.longPress=i.active&&Date.now()-i.lastChange>=I}}static isShortJumping(){return this.isKeyShortPressed(" ","ArrowUp")||this.isMouseButtonShortPressed(0)||this.isGamepadButtonShortPressed(0,12)}static isLongJumping(){return this.isKeyLongPressed(" ","ArrowUp")||this.isMouseButtonLongPressed(0)||this.isGamepadButtonLongPressed(0,12)}static isCrouching(){return this.isKeyDown("ArrowDown")||this.isMouseButtonDown(2)||this.isGamepadButtonDown(13,1)}static isTogglingAI(){return this.isKeyJustPressed("a")||this.isMouseButtonJustPressed(1)||this.isGamepadButtonJustPressed(9)}static vibrate(){var t;navigator.vibrate&&navigator.vibrate(200),(t=this.gamepad)!=null&&t.vibrationActuator&&this.gamepad.vibrationActuator.playEffect("dual-rumble",{duration:100,strongMagnitude:.5,weakMagnitude:.25})}static setup(t){if(window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.mouse.x=window.innerWidth/2,this.mouse.y=window.innerHeight/2,t.canvas.element.addEventListener("click",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("mousemove",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("mousedown",this.onMouseDown.bind(this)),t.canvas.element.addEventListener("mouseup",this.onMouseUp.bind(this)),t.canvas.element.addEventListener("pointermove",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("pointerdown",this.onPointerDown.bind(this,t.canvas.element)),t.canvas.element.addEventListener("pointerup",this.onPointerUp.bind(this,t.canvas.element)),"getGamepads"in navigator){"ongamepadconnected"in window?(window.addEventListener("gamepadconnected",this.onGamepadConnected.bind(this)),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected.bind(this))):this.requestGamepadPoll();for(let e of Object.values(rt))this.gamepadButtons[e]={active:!1,lastChange:Date.now(),lastTrigger:Date.now(),justPressed:!1,justReleased:!1,longPress:!1,shortPress:!1}}}static update(){this.invalidated&&y.setup(),this.invalidated=!1,this.updateKeyboard(),this.updateGamepads(),this.updateMouse()}};c.invalidated=!1,c.VERBOSE_KEYBOARD=!1,c.VERBOSE_MOUSE=!1,c.VERBOSE_GAMEPAD=!1,c.keys={},c.mouse=u.zero,c.mouseDelta=u.zero,c.mouseButtons={},c.gamepad=null,c.gamepadButtons={},c.isFirstGamepadConnection=!0,c.gamepadPollingIntervalHandle=-1;var ot=class{constructor(t,e){this.rect=t;this.color=e}render(t){t.strokeStyle=this.color,t.lineWidth=1,t.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},at=class{constructor(t,e){this.rect=t;this.color=e}render(t){t.fillStyle=this.color,t.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},ht=class{constructor(t,e,i,n){this.start=t;this.end=e;this.color=i;this.thickness=n}render(t){t.strokeStyle=this.color,t.lineWidth=this.thickness,t.beginPath(),t.moveTo(this.start.x,this.start.y),t.lineTo(this.end.x,this.end.y),t.stroke()}},lt=class{constructor(t,e,i,n){this.center=t;this.radius=e;this.color=i;this.fill=n}render(t){this.fill?t.fillStyle=this.color:t.strokeStyle=this.color,t.lineWidth=1,t.beginPath(),t.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),this.fill?t.fill():t.stroke()}},ut=class{constructor(t,e,i,n){this.text=t;this.position=e;this.color=i;this.alignment=n}render(t){t.save(),t.fillStyle=this.color,t.font="12px Arial",t.textAlign=this.alignment,t.fillText(this.text,this.position.x,this.position.y),t.restore()}},ct=class{constructor(t,e,i){this.origin=t;this.vector=e;this.color=i;this.ARROWHEAD_LENGTH=10;this.ARROWHEAD_ANGLE=Math.PI/6;this.MIN_LENGTH=1;this.MAX_LENGTH=100}render(t){let e=this.vector.length;if(e<this.MIN_LENGTH)return;e>this.MAX_LENGTH&&(this.vector=this.vector.normalize().multiply(this.MAX_LENGTH),e=this.MAX_LENGTH);let i=(e-this.MIN_LENGTH)/(this.MAX_LENGTH-this.MIN_LENGTH),n=M.alpha(this.color,i);t.fillStyle=n,t.strokeStyle=n,t.lineWidth=1.5,t.lineCap="round",t.beginPath(),t.moveTo(this.origin.x,this.origin.y),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.stroke();let o=10,p=Math.PI/6,l=Math.atan2(this.vector.y,this.vector.x);t.beginPath(),t.moveTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.lineTo(this.origin.x+this.vector.x-o*Math.cos(l-p),this.origin.y+this.vector.y-o*Math.sin(l-p)),t.lineTo(this.origin.x+this.vector.x-o*Math.cos(l+p),this.origin.y+this.vector.y-o*Math.sin(l+p)),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.fill()}},A=class{static render(t){}static clear(){}static rect(t,e="#fff"){}static outline(t,e="#fff"){}static line(t,e,i="#fff",n=1){}static circle(t,e,i="#fff",n=!0){}static text(t,e,i="#fff",n="left"){}static arrow(t,e,i="#fff"){}},w=A;w.list=[];var v=class{static set(t){this.current!==t&&(this.current=t,this.isDirty=!0)}static apply(t=document.body){this.isDirty&&(this.isDirty=!1,t.style.cursor=this.current)}static reset(){this.current="default",this.isDirty=!0}};v.current="default",v.isDirty=!1;var J=class{static setup(){return f(this,null,function*(){let t=`${48}pt ${T}`;document.fonts.check(t)||(yield document.fonts.load(t))})}};var O=class{setup(){return Promise.resolve()}update(t){}render(t){}};var D=class{constructor(){this.position=u.zero;this.velocity=u.zero;this.acceleration=u.zero}update(t){}render(t){}};var W=class extends D{constructor(e){super();this.state=e;this.velocity.x=P}update(e){this.position.x+=this.velocity.x*this.state.speed*e,this.position.x>=s.ground.width&&(this.position.x-=s.ground.width)}render(e){e.drawImage(s.source,s.ground.x+this.position.x,s.ground.y,this.state.width,s.ground.height,0,this.state.height-s.ground.height,this.state.width,s.ground.height),this.position.x+this.state.width>s.ground.width&&e.drawImage(s.source,s.ground.x,s.ground.y,this.position.x+this.state.width-s.ground.width,s.ground.height,s.ground.width-this.position.x,this.state.height-s.ground.height,this.position.x+this.state.width-s.ground.width,s.ground.height)}};var N=class extends D{};var Nt=[s.smallCactus0,s.smallCactus1,s.smallCactus2,s.smallCactus3,s.smallCactus4,s.smallCactus5],Ut=[s.bigCactus0,s.bigCactus1,s.bigCactus2,s.bigCactus3,s.bigCactus4],U=class extends N{constructor(e){super();this.state=e;this.isBig=Math.random()<Ct;let i=this.isBig?Ut:Nt;this.sprite=i[Math.floor(Math.random()*i.length)],this.velocity.x=P,this.position.x=this.state.width+this.sprite.width,this.position.y=this.state.height-s.ground.height-this.sprite.height+s.groundOffset}get bounds(){return new m(this.position.x,this.position.y,this.sprite.width,this.sprite.height)}get isOutOfScreen(){return this.position.x+this.sprite.width<0}update(e){this.position.x-=this.velocity.x*this.state.speed*e}render(e){e.drawSprite(this.sprite,this.position.x,this.position.y),w.outline(this.bounds,"green")}};var B=class extends N{constructor(e){super();this.state=e;this.velocity.x=P,this.position.x=this.state.width+this.sprite.width,this.position.y=this.state.height-s.ground.height-s.dinoIdle.height-this.sprite.height/2}get sprite(){return this.state.main.globalTimer%.5>.25?s.pterodactyl0:s.pterodactyl1}get isOutOfScreen(){return this.position.x+this.sprite.width<0}get bounds(){return new m(this.position.x,this.position.y,this.sprite.width,this.sprite.height)}update(e){this.position.x-=this.velocity.x*this.state.speed*e}render(e){e.drawSprite(this.sprite,this.position.x,this.position.y),w.outline(this.bounds,"yellow")}};var z=class{constructor(t){this.state=t;this.spawnTimer=0}update(t){this.spawnTimer+=t;let e=window.isMobile(),i=this.state.width/P/this.state.speed*(e?xt:Tt);if(this.spawnTimer>=i){if(!e&&this.state.main.globalTimer>=Et&&Math.random()<=St*this.state.speed)a.debug("ObstacleSpawner","Spawning Pterodactyl..."),this.state.obstacles.push(new B(this.state));else if(Math.random()<=vt*this.state.speed)a.debug("ObstacleSpawner","Spawning Cactus..."),this.state.obstacles.push(new U(this.state));else return;Math.random()>yt/this.state.speed?this.spawnTimer=0:(this.spawnTimer-=i/2,a.debug("ObstacleSpawner","Double spawn!"))}}};var x=class{static get highestScore(){if(this.highestScoreCache)return this.highestScoreCache;let t=localStorage.getItem(this.KEY);return t?(this.highestScoreCache=parseInt(t,10),this.highestScoreCache):0}static set highestScore(t){this.highestScoreCache=t,this.isCurrentHighest=!0,localStorage.setItem(this.KEY,t.toString())}};x.KEY="highestScore",x.highestScoreCache=null,x.isCurrentHighest=!1;var F=class extends O{constructor(e,i,n,o,p){super();this.ground=e;this.obstacles=n;this.score=o;this.main=p;this.dimTimer=0;this.dinoPosition=i.position.clone()}get width(){return this.main.screen.width}get height(){return this.main.screen.height}invalidate(){this.main.invalidate()}setup(){return f(this,null,function*(){v.set("pointer")})}update(e){return f(this,null,function*(){this.dimTimer>=1?this.dimTimer=1:this.dimTimer+=e,c.isDirty&&this.main.setState(new k(this.main)),this.invalidate()})}render(e){this.ground.render(e),this.obstacles.forEach(o=>o.render(e)),e.drawSprite(s.dino4,this.dinoPosition.x,this.dinoPosition.y),e.save(),e.globalAlpha=Math.pow(this.dimTimer,2),e.shadowColor=d.containerShadow,e.shadowBlur=10*Math.pow(this.dimTimer,4),e.shadowOffsetY=2.5,e.textBaseline="top",e.font=`${48}pt ${T}`,e.fillStyle=d.foreground,e.fillTextAligned("GAME OVER",this.width/2,this.height/2-48*2.5,"center"),e.font=`${48/2}pt ${T}`,e.fillStyle=M.alpha(d.foreground,Math.pow(Math.oscilate(this.main.globalTimer,.5,.25,.75),2)),e.fillTextAligned("Press to restart",this.width/2,this.height/2-48,"center");let i=s.resetButton.width/2,n=s.resetButton.height/2;e.drawSprite(s.resetButton,this.width/2-i/2,this.height/1.75,i,n),e.font=`${48/3}pt ${T}`,x.isCurrentHighest?(e.fillStyle=M.alpha(d.foreground,Math.pow(Math.oscilate(this.main.globalTimer,.25,.75,1),2)),e.fillTextAligned(`New high score: ${this.score}`,this.width/2,this.height/1.75+48,"center")):(e.fillStyle=d.foreground,e.fillTextAligned(`Score: ${this.score}`,this.width/2,this.height/1.75+48,"center")),e.restore()}};var q=class extends D{constructor(e){super();this.state=e;this.spriteTimer=0;this.isCrouching=!1;this.position.x=15,this.position.y=this.state.height-s.ground.height-this.sprite.height+s.groundOffset}get groundHeight(){let e=this.isCrouching?s.dinoCrouch1.height:s.dino0.height;return this.state.height-s.ground.height-e+s.groundOffset}get isGrounded(){return this.velocity.y>=0&&this.position.y>=this.groundHeight}get sprite(){return this.state instanceof F?s.dino4:this.isGrounded?this.isCrouching?this.spriteTimer<.25?s.dinoCrouch2:s.dinoCrouch1:this.spriteTimer<.25?s.dino3:s.dino2:s.dino0}get bounds(){let e=this.sprite;return new m(this.position.x,this.position.y,e.width,e.height)}updateInvulnerability(e){this.state.isInvulnerable&&(this.state.invulnerabilityTimer+=e,this.state.invulnerabilityTimer>=ft&&(this.state.isInvulnerable=!1,this.state.invulnerabilityTimer=0))}updateInput(){c.isCrouching()?this.isGrounded?(this.isCrouching=!0,this.position.y=this.groundHeight):(this.isCrouching=!1,this.acceleration.y+=9.8):(this.isCrouching=!1,this.isGrounded&&(c.isShortJumping()?(a.debug("Input","Regular jump!"),this.jump(L)):c.isLongJumping()&&(a.debug("Input","Long jump!"),this.jump(V))))}jump(e=1){this.isGrounded&&(a.debug("Dino","Jumping!"),this.acceleration.y=gt*e,y.play("jump"))}applyConstraints(){this.position.y>=this.groundHeight?(this.position.y=this.groundHeight,this.velocity.y=0):this.position.y<0&&(this.position.y=0,this.velocity.y=0)}update(e){if(this.updateInvulnerability(e),this.spriteTimer+=e*this.state.speed,this.spriteTimer>=.25*2&&(this.spriteTimer-=.25*2),!this.isGrounded){let i=window.isMobile()?H:1;this.velocity.y<0?this.acceleration.y=4.9*i:this.acceleration.y=9.8*i}this.updateInput(),this.position.y+=this.velocity.y*e+.5*this.acceleration.y*Math.pow(e,2),this.velocity.y+=this.acceleration.y,this.applyConstraints(),w.circle(this.position.add(this.bounds.size.divide(2)),5),w.arrow(this.position.add(this.bounds.size.divide(2)),this.velocity.normalize().multiply(this.sprite.height/2),d.secondary)}render(e){e.save(),this.state.isInvulnerable&&(e.globalAlpha=Math.oscilate(this.state.main.globalTimer,2.5,.25,.75)),e.drawSprite(this.sprite,this.position.x,this.position.y),e.restore(),w.outline(new m(this.position.x,this.position.y,this.sprite.width,this.sprite.height),"rgba(255, 0, 0, 0.5)")}};var Z=class extends q{constructor(){super(...arguments);this.isJumping=!1;this.jumpTimer=0;this.jumpTimeSum=.68;this.jumpTimeCount=1;this.enabled=!1}get jumpDuration(){return this.jumpTimeSum/this.jumpTimeCount}updateJumpResponse(){let e=this.state.obstacles.find(g=>g);if(!e)return;this.isCrouching=!1;let i=e.position.x-(this.position.x+this.sprite.width),n=i/(e.velocity.x*this.state.speed),o=this.jumpDuration/2,p=Math.clamp(n-o,0,1),l=this.position.add(new u(this.sprite.width,this.sprite.height/2)).add(e.position.add(new u(0,e.sprite.height/2)).subtract(this.position.add(new u(this.sprite.width,this.sprite.height/2))).multiply(p));if(w.line(this.position.add(new u(this.sprite.width,this.sprite.height/2)),l,"red"),n<=o||e.position.x<this.position.x+this.sprite.width)if(e instanceof U&&i>0)if(e.isBig){let g=L+(V-L)*e.sprite.width/s.bigCactus4.width;this.jump(g)}else this.jump(L);else e instanceof B&&(this.isGrounded?(this.isCrouching=!0,this.position.y=this.groundHeight):this.isCrouching=!1);else this.isCrouching=!this.isGrounded}updateInput(){super.updateInput(),c.isTogglingAI()&&(this.enabled=!this.enabled),this.enabled&&this.updateJumpResponse()}jump(e){super.jump(e),this.isGrounded&&(this.isJumping=!0,this.jumpTimer=0)}update(e){super.update(e),this.isGrounded?this.isJumping&&(this.isJumping=!1,this.jumpTimeSum+=this.jumpTimer,this.jumpTimeCount++):this.isJumping&&(this.jumpTimer+=e),w.text(`JT: ${this.jumpTimer}`,new u(this.state.width/2,this.state.height/2+50),"white","center")}};var k=class extends O{constructor(e){super();this.main=e;this.scoreTimer=0;this.rawSpeed=0;this.rawScore=0;this.lives=0;this.isInvulnerable=!1;this.invulnerabilityTimer=0}get width(){return this.main.screen.width}get height(){return this.main.screen.height}get score(){return Math.floor(this.rawScore).toString().padStart(4,"0")}get speed(){return this.rawSpeed*(window.isMobile()?H:1)}invalidate(){this.main.invalidate()}setup(){return f(this,null,function*(){a.debug("StatePlay","Setting up..."),x.isCurrentHighest=!1,this.lives=3,this.rawScore=0,this.rawSpeed=0,this.dino=new Z(this),this.ground=new W(this),this.obstacles=[],this.spawner=new z(this),v.set("none")})}onHitObstacle(){a.debug("StatePlay","Dino hit by obstacle!"),c.vibrate(),this.lives>1?(this.isInvulnerable=!0,this.invulnerabilityTimer=0,this.lives-=1,y.play("phase")):!1||(y.play("gameover"),this.main.setState(new F(this.ground,this.dino,this.obstacles,this.score,this.main)))}updateScore(e){this.scoreTimer+=e,this.scoreTimer>=st&&(this.scoreTimer-=st,this.rawScore++,x.highestScore<this.rawScore&&(x.highestScore=Math.floor(this.rawScore)),this.rawScore%100===0&&y.play("score"))}updateSpeed(e){this.rawSpeed<1?this.rawSpeed+=2*Math.sqrt(this.rawSpeed)*e+e*e:this.rawSpeed+=.0057*e}update(e){return f(this,null,function*(){this.updateScore(e),this.updateSpeed(e),this.spawner.update(e),this.ground.update(e),this.dino.update(e);for(let i=this.obstacles.length-1;i>=0;i--){let n=this.obstacles[i];n.update(e),n.isOutOfScreen?this.obstacles.splice(i,1):!this.isInvulnerable&&R.pixelPerfectCollision(this.dino.position,this.dino.sprite,n.position,n.sprite)&&this.onHitObstacle()}this.invalidate()})}render(e){this.ground.render(e),this.obstacles.forEach(i=>i.render(e)),this.dino.render(e),e.font=`${48/3}pt ${T}`,e.fillStyle=d.foreground,e.textBaseline="top",x.isCurrentHighest?e.fillTextAligned(`HI Score: ${this.score}`,this.width-15,15,"right"):e.fillTextAligned(`Score: ${this.score}`,this.width-15,15,"right"),e.fillTextAligned(`Lives: ${this.lives}`,this.width-15,15+48/2.5,"right")}};var K=class extends O{constructor(e){super();this.main=e;this.dimTimer=0;this.blinkTimer=0;this.lastBlinkTime=0;this.isBlinking=!1;this.blinkCount=0;this.isTransitioningToPlay=!1;this.startGameTimer=0;this.isJumping=!1;this.jumpTimer=0;this.jumpOffset=0}get width(){return this.main.screen.width}get height(){return this.main.screen.height}invalidate(){this.main.invalidate()}setup(){return f(this,null,function*(){a.debug("StateMenu","Setting up..."),v.set("pointer")})}updateBlinking(e){let i=3.5+Math.random()*2-1,n=.075;this.isBlinking?(this.blinkTimer+=e,this.blinkTimer>=n&&(this.isBlinking=!1,this.blinkCount++,this.blinkCount<2&&Math.random()<=.65?this.lastBlinkTime=this.main.globalTimer-(i-n):this.blinkCount=0)):this.main.globalTimer-this.lastBlinkTime>=i&&Math.random()<=.075&&(this.lastBlinkTime=this.main.globalTimer,this.isBlinking=!0,this.blinkTimer=0)}updateJumping(e){this.isJumping?(this.jumpTimer+=e,this.jumpOffset=Math.pow(Math.sin(this.jumpTimer/.6*Math.PI),2)*s.dino0.height*.75,this.jumpTimer>=.6&&(this.jumpOffset=0,this.jumpTimer=0,this.isJumping=!1,this.isTransitioningToPlay=!0)):this.jumpTimer=0}updateStartGameTransition(e){this.isTransitioningToPlay&&(this.startGameTimer+=e,this.startGameTimer>=3&&this.main.setState(new k(this.main)))}update(e){this.dimTimer+=e,this.dimTimer>=1&&(this.dimTimer=1),this.updateJumping(e),this.updateBlinking(e),this.updateStartGameTransition(e),c.isDirty&&!this.isJumping&&!this.isTransitioningToPlay&&(y.play("jump"),this.isJumping=!0,v.set("default")),this.invalidate()}getDinoSprite(){let e=Math.smoothstep(Math.min(this.startGameTimer/2,1)),i=new m((this.width/2-s.dino0.width/2)*(1-e)+15*e,this.height-s.ground.height-s.dino0.height+s.groundOffset-this.jumpOffset,s.dino0.width,s.dino0.height),n;return this.isJumping?n=s.dino0:e>0&&e<1?n=Math.floor(e*10)%3<=1?s.dino3:s.dino2:e<1&&i.contains(c.mouse)?c.mouse.y<i.y+i.height/2?(n=s.dinoCrouch1,i.y=this.height-s.ground.height-s.dinoCrouch1.height+s.groundOffset):n=s.dinoCrouch2:n=this.isBlinking?s.dino1:s.dino0,{sprite:n,bounds:i}}render(e){e.save(),e.globalAlpha=Math.pow(this.dimTimer,2),e.shadowColor=d.containerShadow,e.shadowBlur=10*Math.pow(this.dimTimer,4),e.shadowOffsetY=2.5,e.textBaseline="top",e.font=`${48}pt ${T}`,e.fillStyle=d.foreground,e.fillTextAligned("Dino",this.width/2,this.height/2-48*2.5,"center"),e.font=`${48/2}pt ${T}`,e.fillStyle=M.alpha(d.foreground,Math.pow(Math.oscilate(this.main.globalTimer,.5,.25,.75),2)),e.fillTextAligned("Press to start",this.width/2,this.height/2-48,"center"),e.shadowBlur=0,e.shadowColor="transparent",e.drawImage(s.source,s.ground.x,s.ground.y,this.width,s.ground.height,0,this.height-s.ground.height,this.width,s.ground.height);let{sprite:i,bounds:n}=this.getDinoSprite();e.drawSprite(i,n.x,n.y),e.restore()}};var G=class extends D{constructor(e,i){super();this.position=e;this.main=i;this.reset()}reset(){this.velocity.x=Math.random()*(wt-it)+it}update(e){this.position.x+=this.velocity.x*e,this.position.x<-s.cloud.width&&(this.reset(),this.position.x=this.main.screen.width+s.cloud.width,this.position.y=Math.random()*this.main.screen.height/2)}render(e){e.drawSprite(s.cloud,this.position.x,this.position.y)}};var X=class{constructor(t){this.main=t;this.cloudSpawnTimer=0}setup(){for(let t=0;t<et/2;t++){let e=new u(Math.random()*this.main.screen.width,Math.random()*this.main.screen.height/2);this.main.clouds.push(new G(e,this.main))}}update(t){if(this.cloudSpawnTimer+=t,this.main.clouds.length<et&&this.cloudSpawnTimer>=bt){this.cloudSpawnTimer=0;let e=new u(this.main.screen.width+1,Math.random()*this.main.screen.height/2),i=!0;for(let n of this.main.clouds)if(Math.abs(n.position.y-e.y)<s.cloud.height){i=!1;break}i&&(a.debug("StatePlay","Spawning cloud at",e.toString()),this.main.clouds.push(new G(e,this.main)))}}};var mt=class{constructor(){this.canvas=new $("canvas");this.screen={width:0,height:0};this.isDirty=!0;this.handleAnimationFrameRequest=-1;this.lastFrameTime=performance.now();this.globalTimer=0;this.cloudSpawner=new X(this);this.clouds=[];a.info("Main","Starting up..."),this.state=new K(this),this.attachHooks()}attachHooks(){a.info("Main","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),c.setup(this)}onLoad(){return f(this,null,function*(){try{a.debug("Main","Window loaded"),this.canvas.attachToElement(document.body),this.onResize();let t=[d.setup(),J.setup(),y.setup(),R.setup(),s.setup()];yield Promise.all(t),yield this.state.setup(),this.cloudSpawner.setup(),this.requestNextFrame()}catch(t){a.error("Main","Failed to load modules",t),alert("Failed to load modules. Please refresh the page.")}})}onVisibilityChange(t){a.info("Main",`Window visibility changed to ${t?"visible":"hidden"}`),t?(this.handleAnimationFrameRequest>=0&&(!0?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest)),this.invalidate(),this.lastFrameTime=performance.now(),setTimeout(this.requestNextFrame.bind(this),0)):this.handleAnimationFrameRequest&&(!0?cancelAnimationFrame(this.handleAnimationFrameRequest):clearInterval(this.handleAnimationFrameRequest),this.handleAnimationFrameRequest=-1)}onResize(){a.debug("Main","Window resized");let t=window.innerWidth-15*4,e=window.innerHeight-15*4;if(window.isMobile()||window.innerWidth<800)document.body.classList.add("mobile"),t=window.innerWidth,e=window.innerHeight,this.screen={width:t,height:e*.75};else{document.body.classList.remove("mobile");let i=16/10,n=1200,o=n/i;t>n&&(t=n),e>o&&(e=o),t/e>i?t=e*i:e=t/i,this.screen={width:t,height:e}}this.canvas.setSize(t,e),this.invalidate()}setState(t){this.state=t,this.state.setup(),v.apply(this.canvas.element),this.invalidate()}invalidate(){this.isDirty=!0}requestNextFrame(){!0?this.handleAnimationFrameRequest=requestAnimationFrame(this.loop.bind(this)):this.handleAnimationFrameRequest===-1&&(this.handleAnimationFrameRequest=setInterval(()=>this.loop(performance.now()),1e3/60))}updateClouds(t){this.cloudSpawner.update(t),this.clouds.forEach(e=>e.update(t))}update(t){let e=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t;let i=e/4;for(let n=0;n<4;n++)this.state.update(i),c.update();this.updateClouds(e),this.globalTimer+=e}loop(t){if(this.update(t),v.apply(this.canvas.element),this.isDirty){this.canvas.clear();for(let e of this.clouds)e.render(this.canvas.context);this.state.render(this.canvas.context),this.isDirty=!1,w.render(this.canvas.context),w.clear()}this.requestNextFrame()}};window._instance=new mt;})();
